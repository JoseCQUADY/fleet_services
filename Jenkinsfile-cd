pipeline {
    agent any

    environment {
        SSH_KEY_ID = 'oracle_ssh_key' // ID de la credencial en Jenkins
        SSH_KEY_PATH = "${env.WORKSPACE}/temp_ssh_key" // ruta temporal para la clave privada
    }

    stages {
        stage('Use SSH Key Directly') {
            steps {
                script {
                    // Escribir la clave privada en un archivo temporal
                    withCredentials([sshUserPrivateKey(credentialsId: env.SSH_KEY_ID, keyFileVariable: 'KEYFILE')]) {
                        sh '''
                            cp $KEYFILE ${SSH_KEY_PATH}
                            chmod 600 ${SSH_KEY_PATH}
                        '''
                    }

                    // Ejecutar el comando SSH usando la clave privada
                    sh '''
                        ssh -i ${SSH_KEY_PATH} -o StrictHostKeyChecking=no opc@your.oracle.server "echo 'Connected without sshagent!'"
                    '''

                    // Borrar el archivo temporal de clave privada
                    sh "rm -f ${SSH_KEY_PATH}"
                }
            }
        }
    }
}
